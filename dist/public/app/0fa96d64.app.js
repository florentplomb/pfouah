"use strict";angular.module("transmedApp",["ngCookies","ngResource","ngSanitize","ui.router","ui.bootstrap","ngDialog","LocalStorageModule"]).filter("toArray",function(){return function(a){var b=[];return angular.forEach(a,function(a,c){b.push(a)}),b}}).constant("TwitterUrl","https://api.twitter.com/1.1/").constant("ApiUrl","http://localhost:9000/").config(["localStorageServiceProvider",function(a){a.setPrefix("pfouah").setStorageType("localStorage").setNotify(!0,!0)}]).config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]).config(["$resourceProvider",function(a){a.defaults.stripTrailingSlashes=!1}]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]),angular.module("transmedApp").controller("FeedCtrl",["$scope","$http","$log","TweetService",function(a,b,c,d){d.getTweets(function(b){a.datas=b},function(b){a.error=b});var e=function(){var a=encodeURIComponent("dXQ5VccrbKbQVvFFuDR1igBxi"),b=encodeURIComponent("oNcCuayrTLcx1cmn9F1OVmo19p3i0AIOtUFdYaloVhN79UZymj"),c=btoa(a+":"+b);return c};c.debug("Basic "+e())}]),angular.module("transmedApp").controller("MainCtrl",["$scope","$log","ngDialog",function(a,b,c){a.videos=[{title:"video 1",question:"question 1"},{title:"video 2",question:"question 2"}],a.openDefault=function(a){c.open({template:"app/main/modal/modal1.html",plain:!1,controller:"FirstPopupCtrl",className:"ngdialog-theme-default",data:a,closeByEscape:!1,closeByDocument:!1,showClose:!1,cache:!1})}}]),angular.module("transmedApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}).state("rankings",{url:"/ranking",templateUrl:"app/ranking/ranking.html",controller:"RankingCtrl"}).state("photowall",{url:"/photowall",templateUrl:"app/photowall/photowall.html",controller:"WallCtrl"}).state("partner",{url:"/partner",templateUrl:"app/partner/partner.html",controller:"PartnerCtrl"}).state("feed",{url:"/feed",templateUrl:"app/feed/feed.html",controller:"FeedCtrl"})}]),angular.module("transmedApp").controller("FirstPopupCtrl",["$scope","$log","ngDialog",function(a,b,c){a.openSecond=function(a){c.close(),c.open({template:"app/main/modal/modal2.html",plain:!1,controller:"SecondPopupCtrl",className:"ngdialog-theme-default",data:a,closeByEscape:!1,closeByDocument:!1,showClose:!1,cache:!1})}}]).controller("SecondPopupCtrl",["$scope","$log","ngDialog",function(a,b,c){a.feedback="",a.closeSecond=function(){c.close()},a.submitForm=function(d){b.debug(d),(d.length<1||d.length>=140)&&(d=void 0,a.feedback="Il n'y a rien à envoyer."),c.close()}}]),angular.module("transmedApp").controller("PartnerCtrl",["$scope","$http","$log",function(a,b,c){}]),angular.module("transmedApp").controller("WallCtrl",["$scope","$http","$log","StaticService","ApiService","localStorageService",function(a,b,c,d,e,f){function g(a,b){return f.set(a,b)}function h(a){return f.get(a)}a.error="",a.res="",a.getItem=function(a){return f.get(a)},e.getUsers(function(b){a.datas=b;for(var d=a.datas.length-1;d>=0;d--)a.datas[d].imgUrl="http://pfouah2015.herokuapp.com/"+b[d].imgUrl,c.debug(a.datas[d].imgUrl)},function(b){a.error=b}),a.likePlayer=function(b){a.res=h(b._id),null==a.res?(g(b._id,b._id),b.like++,a.error="vote comptabilisé !!!"):a.error="Vous avez déjà voté pour cette image auparavant!"},a.dislikePlayer=function(b){a.res=h(b._id),null==a.res?(g(b._id,b._id),e.likeImage(b._id,"p",function(b){a.datas.like=b.like,a.error="Vote comptabilisé."},function(b){a.error="Une erreur s'est produite."})):a.error="Vous avez déjà voté pour cette image auparavant!"}}]),angular.module("transmedApp").controller("RankingCtrl",["$scope","$http","$log","StaticService",function(a,b,c,d){d.getScores(function(b){for(var c=[],d=b.length;d>=0;d--)c.push(d);b.sort(function(a,b){return a.scores.scoreTot-b.scores.scoreTot});for(var d=b.length-1;d>=0;d--)b[d].posTot=c[d];b.sort(function(a,b){return a.scores.totalHs-b.scores.totalHs});for(var d=b.length-1;d>=0;d--)b[d].posCumul=c[d];b.sort(function(a,b){return a.scores.hsWash-b.scores.hsWash});for(var d=b.length-1;d>=0;d--)b[d].posWash=c[d];b.sort(function(a,b){return a.scores.hsFlash-b.scores.hsFlash});for(var d=b.length-1;d>=0;d--)b[d].posFlash=c[d];b.sort(function(a,b){return a.scores.hsTrash-b.scores.hsTrash});for(var d=b.length-1;d>=0;d--)b[d].posTrash=c[d];a.datas=b,a.predicate="posTot",a.reverse=""},function(b){a.error=b}),a.tabs=[{title:"Totaux",id:"1",predicate:"posTot",reverse:""},{title:"Cummulés",id:"2",predicate:"posCumul",reverse:""},{title:"Wash",id:"3",predicate:"posWash",reverse:""},{title:"Trash",id:"4",predicate:"posTrash",reverse:""},{title:"Flash",id:"5",predicate:"posFlash",reverse:""}],a.activeTab=a.tabs[0].id,a.showTab=function(b){a.activeTab=b;var c=b-1;a.predicate=a.tabs[c].predicate,a.reverse=a.tabs[c].reverse}}]),angular.module("transmedApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("transmedApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("transmedApp").controller("NavbarCtrl",["$scope","$location",function(a,b){a.menu=[{title:"Home",link:"/"},{title:"Rankings",link:"/ranking"},{title:"Photowall",link:"/photowall"},{title:"Feeds",link:"/feed"},{title:"Partners",link:"/partner"}],a.isCollapsed=!0,a.logout=function(){Auth.logout(),b.path("/login")},a.isActive=function(a){return a===b.path()}}]),angular.module("transmedApp").factory("ApiService",["$http","ApiUrl",function(a,b){return{getScores:function(c,d){a({method:"GET",url:b+"api/users/scores"}).success(function(a){c(a)}).error(function(a){d(a)})},getUsers:function(c,d){a({method:"GET",url:b+"api/users"}).success(function(a){c(a)}).error(function(a){d(a)})},getCode:function(c,d){a({method:"GET",url:b+"api/limitLikes"}).success(function(a){c(a)}).error(function(a){d(a)})},likeImage:function(c,d,e,f){a({method:"POST",url:b+"api/images/"+c+"/liked",data:d}).success(function(a){e(a)}).error(function(a){f(a)})}}}]).factory("StaticService",["$http",function(a){return{getScores:function(b,c){a({method:"GET",url:"assets/json/users.scores.json"}).success(function(a){b(a)}).error(function(a){c(a)})},postUser:function(b,c,d){a({method:"PUT",url:"assets/json/users.scores.json"}).success(function(a){c(a)}).error(function(a){d(a)})},getUsers:function(b,c){a({method:"GET",url:"assets/json/users.json"}).success(function(a){b(a)}).error(function(a){c(a)})},getCode:function(b,c){a({method:"GET",url:"http://pfouah2015.herokuapp.com/api/limitLikes"}).success(function(a){b(a)}).error(function(a){c(a)})}}}]),angular.module("transmedApp").factory("TweetService",["$http","TwitterUrl",function(a,b){return{getTweets:function(c,d){a({method:"GET",url:b+"statuses/user_timeline.json?screen_name=eve_status&count=2"}).success(function(a){c(a)}).error(function(a){d(a)})}}}]),angular.module("transmedApp").run(["$templateCache",function(a){a.put("app/feed/feed.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><a class=twitter-timeline href=https://twitter.com/EVE_status data-widget-id=590066890699046913>Tweets de @EVE_status</a><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?\'http\':\'https\';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>'),a.put("app/main/main.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container ng-repeat="video in videos"><div class=video><button type=button ng-click=openDefault(video)>Regarder : {{video.title}}</button></div></div>'),a.put("app/main/modal/modal1.html",'<div class=ngdialog-message><h4>{{ngDialogData.title}}</h4><video width=400 height=300 controls><source ng-src={{ngDialogData.url}} type=video/mp4></source><source ng-src={{ngDialogData.url}} type=video/ogg>Your browser does not support the video tag.</source></video></div><div class=ngdialog-buttons><button type=button class="ngdialog-button ngdialog-button-primary" ng-click=openSecond(ngDialogData)>Suivant</button></div>'),a.put("app/main/modal/modal2.html",'<div class=ngdialog-message><h4>{{ngDialogData.question}}</h4><form name=myForm><label><input name=answer class=ngdialog-content ng-model=answer ng-maxlength=140 ng-minlength=1 placeholder="votre réponse"></label><div role=alert><span class=error ng-bind=feedback></span> <span class=error ng-show=myForm.answer.$error.maxlength>140 charactères maximum !</span> <span class=error ng-show=myForm.answer.$error.minlength>1 charactères minimum !</span></div></form></div><div class=ngdialog-buttons><button type=button class="ngdialog-button ngdialog-button-primary" ng-click=closeSecond()>Fermer</button> <button type=submit class="ngdialog-button ngdialog-button-secondary" ng-click=submitForm(answer) ng-disabled="myForm.$invalid || myForm.$pristine">Envoyer</button></div>'),a.put("app/partner/partner.html","<div ng-include=\"'components/navbar/navbar.html'\"></div><p>partner</p>"),a.put("app/photowall/photowall.html",'<!-- <div ng-include="\'components/navbar/navbar.html\'"></div> --><div class=container><!-- <h1>photowall</h1>\n	<p>Like or dislike your friends !</p> --><div deckgrid class=deckgrid source=photos ng-repeat="photo in datas | toArray | orderBy:\'-like\' "><div class=img-box><img class=img-wall src="http://img0.gtsstatic.com/hybride/le-chat-de-savannah-tient-du-chat-domestique-et-d-un-chat-sauvage-africain_21040_wide.jpg"><div class=content-over><!-- bouton dislike --><div type=button ng-show="getItem(photo._id) == null" ng-click=likePlayer(photo) class="like button"><span class="glyphicon glyphicon-thumbs-up" aria-hidden=true></span></div><!-- bouton dislike --><div type=button ng-show="getItem(photo._id) == null" ng-click=dislikePlayer(photo) class="dislike button"><span class="glyphicon glyphicon-thumbs-down" aria-hidden=true></span></div><!-- compteur de like --><!-- <p class="p-cpt likes label label-primary label-as-badge" ng-show="photo.like >= 2"> {{photo.like}} likes</p>\n	        	<p class="p-cpt likes label label-primary label-as-badge" ng-show="photo.like == 0 || photo.like == 1">{{photo.like}} like</p>\n	        	<p class="p-cpt likes label label-primary label-as-badge" ng-show="photo.like == -1">{{photo.like}} dislike</p>\n	        	<p class="p-cpt likes label label-primary label-as-badge" ng-show="photo.like <= -2">{{photo.like}} dislikes</p> --></div><div class=likesContainer><p class=likes ng-show="photo.like >= 2">{{photo.like}} likes</p><p class=likes ng-show="photo.like == 0 || photo.like == 1">{{photo.like}} like</p><p class=likes ng-show="photo.like == -1">{{photo.like}} dislike</p><p class=likes ng-show="photo.like <= -2">{{photo.like}} dislikes</p></div></div></div><p>{{error}}</p></div>'),a.put("app/ranking/ranking.html",'<div ng-include="\'components/navbar/navbar.html\'"></div><div class=container><div class="btn btn-primary btn-ranking" ng-repeat="tab in tabs" ng-click=showTab(tab.id)>{{tab.title}}</div><hr><h3 ng-show="activeTab == 1">Tableau des scores</h3><!--<pre>Sorting predicate = {{predicate}}; reverse = {{reverse}}</pre>--><table class="table table-striped"><tr><th ng-show="activeTab == 1"><a ng-click="predicate = \'posTot\'; reverse=!reverse">Position</a></th><th ng-show="activeTab == 2"><a ng-click="predicate = \'posCumul\'; reverse=!reverse">Position</a></th><th ng-show="activeTab == 3"><a ng-click="predicate = \'posWash\'; reverse=!reverse">Position</a></th><th ng-show="activeTab == 4"><a ng-click="predicate = \'posTrash\'; reverse=!reverse">Position</a></th><th ng-show="activeTab == 5"><a ng-click="predicate = \'posFlash\'; reverse=!reverse">Position</a></th><th><a ng-click="predicate = \'pseudo\'; reverse=!reverse">Joueurs</a></th><th ng-show="activeTab == 1">Total</th><th ng-show="activeTab == 2">Cumul</th><th ng-show="activeTab == 3">Wash</th><th ng-show="activeTab == 4">Trash</th><th ng-show="activeTab == 5">Flash</th><th>Avatars</th></tr><tr ng-repeat="player in datas | orderBy: predicate :-reverse"><!-- position : juste one at time --><td ng-show="activeTab == 1">{{player.posTot}}</td><td ng-show="activeTab == 2">{{player.posCumul}}</td><td ng-show="activeTab == 3">{{player.posWash}}</td><td ng-show="activeTab == 4">{{player.posTrash}}</td><td ng-show="activeTab == 5">{{player.posFlash}}</td><td>{{player.pseudo}}</td><td ng-show="activeTab == 1">{{player.scores.scoreTot}} points</td><td ng-show="activeTab == 2">{{player.scores.totalHs}} points</td><td ng-show="activeTab == 3">{{player.scores.hsWash}} points</td><td ng-show="activeTab == 4">{{player.scores.hsTrash}} points</td><td ng-show="activeTab == 5">{{player.scores.hsFlash}} points</td><td><img ng-src=#></td></tr></table></div>'),a.put("components/$OLD/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/$OLD/navmenu/navmenu.html",'<div class=container-menu><div class=element-menu><div class=element-icon><img src="http://loremicon.com/i/line/32/upload_32px"></div><a class=element-text href="/">Home</a></div><div class=element-menu><div class=element-icon><img src="http://loremicon.com/i/line/32/upload_32px"></div><a class=element-text href=/rankings>Rankings</a></div><div class=element-menu><div class=element-icon><img src="http://loremicon.com/i/line/32/upload_32px"></div><a class=element-text href=/photowall>Photowall</a></div><div class=element-menu><div class=element-icon><img src="http://loremicon.com/i/line/32/upload_32px"></div><a class=element-text href=/feeds>Feeds</a></div><div class=element-menu><div class=element-icon><img src="http://loremicon.com/i/line/32/upload_32px"></div><a class=element-text href=/partners>Partners</a></div></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>transmed</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-href={{item.link}}>{{item.title}}</a></li></ul></div></div></div>')}]);